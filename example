<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>新建病例</title>
    <link rel="stylesheet" href="/layui/css/layui.css">
    <link rel="stylesheet" href="/css/css.css">
    <script src='/js/jquery.min.js'></script>
    <script src="/layui/layui.js"></script>
    <script src="/js/public.js?t=1"></script>
    <script src="/js/vue.js"></script>
    <script src="/js/load.js"></script>
</head>

<body>
    <div id="header" class="header cls"></div>
    <div class="main tab">
        <div id="maside" class="m-aside"></div>
        <div id="addCaseTop" class="m-head m-head-tab cls"></div>
        <div id="app" class="m-body" v-cloak>
            <form lay-filter="caseForm" class="layui-form form  my-data-form case-form case-form2" action="">
                <h3 id="sjxx" class="vtitle">填写设计信息</h3>
                <div class="layui-row">
                    <div class="layui-col-md6">
                        <ul>
                            <input type="hidden" name="case_no" :value="form.case_no">
                            <li class="layui-form-item cell">
                                <label class="layui-form-label">应用类型：</label>
                                <div class="layui-input-block">
                                    <input type="radio" name="use_type" value="全口" title="全口" checked>
                                    <input type="radio" name="use_type" value="上颌" title="上颌">
                                    <input type="radio" name="use_type" value="下颌" title="下颌">
                                </div>
                            </li>
                            <li class="layui-form-item cell">
                                <label class="layui-form-label">托槽：</label>
                                <div class="layui-input-block">
                                    <select name="fixed_slot" class="fixed_slot" lay-verify="required"
                                        lay-filter="tuocao">
                                        <option v-for="e in selects.tuocao" :value="e.name" :data-bind="e.defult"
                                            :data-bind2="e.defult2">{{e.name}}</option>
                                    </select>
                                </div>
                            </li>

                        </ul>

                    </div>
                    <div class="layui-col-md6">
                        <ul>
                            <li class="layui-form-item cell row-mt">
                                <label class="layui-form-label" style="color: transparent">-</label>
                            </li>
                            <li class="layui-form-item cell row-mt">
                                <label class="layui-form-label">颊面管：</label>
                                <div class="layui-input-block ">
                                    <div class="layui-row layui-col-space10 _jmg">
                                        <div class="layui-col-md6">
                                            <span class="id">6#</span>
                                            <div class="select">
                                                <select name="fixed_face" lay-verify="required" lay-filter="jiamian">
                                                    <option v-for="e in selects.jiamian" :value="e.name">{{e.name}}
                                                    </option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="layui-col-md6">
                                            <span class="id">7#</span>
                                            <div class="select">
                                                <select name="fixed_face2" lay-verify="required" lay-filter="jiamian2">
                                                    <option v-for="e in selects.jiamian2" :value="e.name">{{e.name}}
                                                    </option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </li>

                        </ul>
                    </div>
                </div>
                <div class="layui-form-item cell">
                    <label class="layui-form-label">托槽备注：</label>
                    <div class="layui-input-block">
                        <input name="fixed_slot_desc" placeholder="如需不同托槽转矩搭配，请在此备注..." class="layui-input">
                    </div>
                </div>
                <!-- <div class="layui-form-item cell row-mt">
                    <label class="layui-form-label">定位方案：</label>
                    <div class="layui-input-block">
                        <div class="layui-row ">
                            <div class="layui-col-md4">
                                <input type="radio" lay-filter="setplan" name="set_plan" value="Alpha定位法"
                                    title="Alpha定位法" checked>
                            </div>
                            <div class="layui-col-md2 _raido_m0">
                                <input type="radio" lay-filter="setplan" name="set_plan" value="其它" title="其它">
                            </div>
                            <div class="layui-col-md6" v-if="form.set_plan!='Alpha定位法'">
                                <input id="setPlan" placeholder="" class="layui-input">
                            </div>
                        </div>
                    </div>
                </div> -->
                <div class="layui-form-item cell row-mt">
                    <label class="layui-form-label">定位方案：</label>
                    <div class="layui-input-block">
                        <div class="layui-row radio-why-box">
                            <p class="ritem"><input type="radio" lay-filter="setplan" name="set_plan" value="Alpha定位法"
                                    title="Alpha定位法" checked>
                                <i id="why1" class="layui-icon layui-icon-about showWhy" text="基于冠中心定位法放置默认托槽位置，参考高度定位法调整托槽位置，最后通过理想的矫治目标位（边缘脊连续流畅无台阶）来微调部分托槽位置，使得模拟主弓丝结束时是一个平直的状态。"></i>
                            </p>
                            <p class="ritem">
                                <input type="radio" lay-filter="setplan" name="set_plan" value="冠中心定位法" title="冠中心定位法">
                                <i id="why2" class="layui-icon layui-icon-about showWhy" text="临床冠中心法是将托槽置于牙齿的临床冠中心"></i>
                            </p>
                            <p class="ritem">
                                <input type="radio" lay-filter="setplan" name="set_plan" value="高度定位法" title="高度定位法">
                                <i id="why3" class="layui-icon layui-icon-about showWhy" text="高度定位表法是以中切牙的托槽高度作为参考，其他牙齿的托槽高度依据算出。"></i>
                            </p>
                            <p class="ritem">
                                <input type="radio" lay-filter="setplan" name="set_plan" value="边缘脊定位法" title="边缘脊定位法">
                                <i id="why4" class="layui-icon layui-icon-about showWhy" text="边缘嵴平齐法是通过牙齿边缘嵴线与临床冠中心线之间的差值来确定托槽的位置。"></i>
                            </p>
                        </div>
                    </div>
                </div>
                <div class="layui-input-block dental-two-1" id="bcxx">
                    <div class="hd">
                        <h4>特殊设计要求及情况：</h4>
                        <p v-show="specialStatus==0" @click="specialStatus=1" class="toggle">展开 <i
                                class="layui-icon layui-icon-down"></i></p>
                        <p v-show="specialStatus==1" @click="specialStatus=0" class="toggle">收起 <i
                                class="layui-icon layui-icon-up"></i></p>
                    </div>
                    <div class="layui-row bd" v-show="specialStatus==1">
                        <div class="layui-col-md12">
                            <div class="layui-form-item cell">
                                <label class="layui-form-label">特殊设计：</label>
                                <div class="layui-input-block" style="margin-left: 240px;">
                                    <div class="row cls">
                                        <div class="layui-col-md6"  v-for="(item,index) in selects.tssheji">
                                            <div @click="check_tssheji(item)" v-if="form.tssheji.includes(item)" class="layui-unselect layui-form-checkbox layui-form-checked" lay-skin="primary"><span>{{item}}</span><i class="layui-icon layui-icon-ok"></i></div>
                                            <div @click="check_tssheji(item)" v-else class="layui-unselect layui-form-checkbox" lay-skin="primary"  ><span>{{item}}</span><i class="layui-icon layui-icon-ok"></i></div>
                                        </div>
                                    </div>
                                    <div class="area" style="padding-top:10px ;" v-if="form.tssheji[0]=='自定义'">
                                     <!-- 然后那个最后确定设计信息时只显示这个备注信息 -->
                                        <textarea name="tssheji_custom" v-model="form.tssheji_custom" placeholder="请输入自定义内容" class="layui-textarea" id="" cols="30" rows="2"></textarea>
                                    </div>
                                </div>
                            </div>
                            <div class="layui-form-item cell">
                                <label class="layui-form-label">对存在咬合干扰的托槽：</label>
                                <div class="layui-input-block" style="margin-left: 240px;width: 50%">
                                    <select name="tsqingkuang_yaohe" class="tsqingkuang_yaohe"  v-model="form.tsqingkuang_yaohe">
                                        <option v-for="e in selects.tsqingkuang_yaohe" :value="e.name">{{e.name}}</option>
                                    </select>
                                </div>
                            </div>
                            <div class="layui-form-item cell">
                                <label class="layui-form-label">对于托槽底板侵入牙龈较多的情况：</label>
                                <div class="layui-input-block" style="margin-left: 240px;">
                                    <select name="tsqingkuang_tuocao" class="tsqingkuang_tuocao" v-model="form.tsqingkuang_tuocao">
                                        <option v-for="e in selects.tsqingkuang_tuocao" :value="e.name">{{e.name}}</option>
                                    </select>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

                <div class="layui-row">
                    <label class="layui-form-label">牙位信息：</label>
                    <div class="layui-input-block ljqk-box case-tooth-msg">
                        <p class="tip ">* 请对相应的牙齿进行标注</p>
                        <div class="case-tooth-box">
                            <div class="case-tooths">
                                <canvas v-for="(item,index) in tooth" class="cantooth">
                                    <span>当前浏览器内核不支持Canvas,请更换浏览器.</span></canvas>
                            </div>
                            <dl class="btnbox">
                                <dd :class="['item',{active : index==type}]" @click="type=index"
                                    v-for="(item,index) in toothButton">
                                    <!-- <img v-if="index==type" :src="item.img_ac" alt=""> -->
                                    <img :src="item.img" alt="">
                                    <p class="name">{{item.name}}</p>
                                </dd>
                            </dl>
                            <!-- <div class="btnbox">
                                <p :class="['item',{active : (index+1)==type}]" @click="type=index+1"
                                    v-for="(item,index) in toothButton">
                                    <i class="round"></i>
                                    {{item.name}}
                                </p>
                            </div> -->
                        </div>
                        <div class="ljqk-bottom-box">
                            <!-- <div class="ljqk-radio-list" v-show="type==2"> -->
                            <div class="ljqk-radio-list" v-show="show_zhikang">
                                <p class="tit">支抗选择：</p>
                                <input type="radio" lay-filter="zikang" name="zikang" :value="item" :title="item"
                                    checked v-for="item in ['弱支抗','中支抗','强支抗','不确定']" v-model="form.zikang">
                            </div>
                            <textarea name="tooth_seat_desc" placeholder="备注：少于200字..." class="layui-textarea"
                                maxlength="200"> </textarea>
                        </div>

                    </div>
                </div>

                <div class="layui-input-block dental-two-1" id="bcxx">
                    <div class="hd">
                        <h4>补充信息</h4>
                        <p v-show="supplyStatus==0" @click="supplyStatus=1" class="toggle">展开 <i
                                class="layui-icon layui-icon-down"></i></p>
                        <p v-show="supplyStatus==1" @click="supplyStatus=0" class="toggle">收起 <i
                                class="layui-icon layui-icon-up"></i></p>
                    </div>
                    <div class="layui-row bd" v-show="supplyStatus==1">
                        <div class="layui-col-md6">
                            <ul>
                                <li class="layui-form-item cell">
                                    <label class="layui-form-label">中线纠正：</label>
                                    <div class="layui-input-block">
                                        <input type="radio" lay-verify="required|zxjz" lay-filter="*"
                                            name="center_correct" :value="e" :title="e" v-for="e in ['维持','改善']"
                                            v-model="form.center_correct">
                                    </div>
                                    <div class="layui-input-block" v-show="form.center_correct == '改善' "
                                        id="center_correct_2">
                                        <input type="radio" lay-filter="*" name="center_correct_2" :value="e" :title="e"
                                            v-for="e in ['对齐上中线','对齐下中线','对齐面中线']" v-model="form.center_correct_2">
                                    </div>

                                </li>
                                <li class="layui-form-item cell">
                                    <label class="layui-form-label">上前牙垂直向：</label>
                                    <div class="layui-input-block">
                                        <input type="radio" lay-filter="*" name="front_vertical" :value="e" :title="e"
                                            v-for="e in ['伸长','维持','压低']" v-model="form.front_vertical">
                                    </div>
                                </li>
                                <li class="layui-form-item cell">
                                    <label class="layui-form-label">扩弓：</label>
                                    <div class="layui-input-block">
                                        <input type="radio" lay-filter="*" name="kuogong" :value="e" :title="e"
                                            v-for="e in ['是','否']" v-model="form.kuogong">
                                    </div>
                                </li>
                                <li class="layui-form-item cell">
                                    <label class="layui-form-label">牙列间隙：</label>
                                    <div class="layui-input-block">
                                        <input type="radio" lay-filter="*" name="close_correct" :value="e" :title="e"
                                            v-for="e in ['维持','关闭']" v-model="form.close_correct">
                                    </div>
                                </li>

                            </ul>
                        </div>
                        <div class="layui-col-md6">
                            <ul>
                               <li class="layui-form-item cell">
                                    <label class="layui-form-label">矢状向（左）：</label>
                                    <div class="layui-input-inline"  style="width: 160px;margin-right: 0;">
                                        <input type="radio" lay-filter="*"  name="jiuzhengguanxi_left" :value="e" :title="e" v-for="e in ['维持','调整']" v-model="form.jiuzhengguanxi_left">
                                    </div>
                                    <div class="layui-input-inline" v-show="form.jiuzhengguanxi_left=='调整'" style="width: 100px;margin-right: 0;">
                                        <select name="jiuzhengguanxi_left_2" lay-filter="*" v-model="form.jiuzhengguanxi_left_2">
                                            <option>请选择</option>
                                            <option :value="e"  v-for="e in ['I类关系','II类关系','III类关系']">{{e}}</option>
                                        </select>
                                    </div>
                                </li>
                                <li class="layui-form-item cell">
                                    <label class="layui-form-label">矢状向（右）：</label>
                                    <div class="layui-input-inline"  style="width: 160px;margin-right: 0;">
                                        <input type="radio" lay-filter="*"  name="jiuzhengguanxi_right" :value="e" :title="e" v-for="e in ['维持','调整']" v-model="form.jiuzhengguanxi_right">
                                    </div>
                                    <div class="layui-input-inline" v-show="form.jiuzhengguanxi_right=='调整'" style="width: 100px;margin-right: 0;">
                                        <select name="jiuzhengguanxi_right_2" lay-filter="*" v-model="form.jiuzhengguanxi_right_2">
                                            <option>请选择</option>
                                            <option :value="e"  v-for="e in ['I类关系','II类关系','III类关系']">{{e}}</option>
                                        </select>
                                    </div>
                                </li>
                                <!-- <li class="layui-form-item cell">
                                    <label class="layui-form-label">矢状向：</label>
                                    <div class="layui-input-block">
                                        <input type="radio" lay-filter="*" name="jiuzhengguanxi" :value="e" :title="e"
                                            v-for="e in ['左','右']" v-model="form.jiuzhengguanxi">
                                    </div>
                                    <div class="layui-input-block" v-show="form.jiuzhengguanxi" id="jiuzhengguanxi_2">
                                        <input type="radio" lay-filter="*" class="jiuzhengguanxi_2"
                                            name="jiuzhengguanxi_2" :value="e" :title="e" v-for="e in ['维持','调整']"
                                            v-model="form.jiuzhengguanxi_2">
                                    </div>
                                    <div class="layui-input-block"
                                        v-show="form.jiuzhengguanxi_2 == '调整' && form.jiuzhengguanxi"
                                        id="jiuzhengguanxi_3">
                                        <input type="radio" lay-filter="*" id="cc" name="jiuzhengguanxi_3" :value="e"
                                            :title="e" v-for="e in ['I类关系','II类关系','III类关系']"
                                            v-model="form.jiuzhengguanxi_3">
                                    </div>
                                </li> -->
                                <li class="layui-form-item cell">
                                    <label class="layui-form-label">上后牙垂直向：</label>
                                    <div class="layui-input-block">
                                        <input type="radio" lay-filter="*" name="back_vertical" :value="e" :title="e"
                                            v-for="e in ['伸长','维持','压低']" v-model="form.back_vertical">
                                    </div>
                                </li>
                                <li class="layui-form-item cell">
                                    <label class="layui-form-label">去釉：</label>
                                    <div class="layui-input-block">
                                        <input type="radio" lay-filter="*" name="quyou" :value="e" :title="e"
                                            v-for="e in ['是','否']" v-model="form.quyou">
                                    </div>
                                </li>

                            </ul>
                        </div>
                    </div>
                </div>


                <div class="layui-form-item  btns cell" v-if="is_close==0">
                    <div class="layui-input-block">
                        <div class="layui-input-inline">
                            <a :href="'./index.html?id='+form.case_no"><button type="button"
                                    class="layui-btn layui-btn-primary bg">返回上一步</button></a>
                        </div>
                        <div class="layui-input-inline">
                            <button type="button" class="layui-btn vsubmit" lay-submit
                                lay-filter="caseForm">下一步，上传照片</button>
                        </div>
                    </div>
                </div>

            </form>
        </div>
        <script>
            let that = null;

            var app = new Vue({
                el: '#app',
                data: {
                    is_close: 0,
                    supplyStatus: true,
                    specialStatus: true,
                    selects: {},
                    show_zhikang:false,
					// tssheji_arr:['无','上前牙偏切端定位0.5mm','上前牙偏龈端定位0.5mm','下前牙偏切端定位0.5mm','下前牙偏龈端定位0.5mm','过矫治','自定义'],
					// tsqingkuang_yaohe_arr:['正常设计','可为避开干扰往龈方设计','不设计托槽位置'],
					// tsqingkuang_tuocao_arr:['不设计托槽位置','正常设计','为避免侵入牙龈往牙合方设计（若正常设计、底板侵入牙龈超过0.65mm，超过龈间沟深度需临床切龈处理）'],
					tssheji_arr:[],
					tsqingkuang_yaohe_arr:[],
					tsqingkuang_tuocao_arr:[],

                    form: {
                        case_no: '',
                        use_type: '',
                        set_plan: '',

						tssheji: [],
						tssheji_custom:"",
						tsqingkuang_yaohe:'',
						tsqingkuang_tuocao:'',

                        fixed_slot: '',
                        fixed_face: '',
                        fixed_face2: '',
                        quyou: '',
                        zikang: "",
                        center_correct: '',
                        center_correct_2: '',
                        gap_handle: '',
                        close_correct: '',
                        kuogong: '',
                        cunqing: '',

                        jiuzhengguanxi: '',
                        jiuzhengguanxi_left: "",
                        jiuzhengguanxi_left_2: "",
                        jiuzhengguanxi_right: "",
                        jiuzhengguanxi_right_2: "",

                        front_vertical: "",
                        back_vertical: "",
                        tooth_seat: '',
                        tooth_seat_desc: '',

                        fixed_slot_desc: ''
                    },

                    tooth: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    // toothButton: ['缺失', '拔除', '不可粘贴', '不可移动'],
                    toothButton: [
                        { img: "/images/teeth/a.png", img_ac: "/images/teeth/a2.png", name: '正常' },
                        { img: "/images/teeth/b.png", img_ac: "/images/teeth/b2.png", name: '缺失' },
                        { img: "/images/teeth/c.png", img_ac: "/images/teeth/c2.png", name: '拔除' },
                        { img: "/images/teeth/d.png", img_ac: "/images/teeth/d2.png", name: '不可粘贴' },
                        { img: "/images/teeth/e.png", img_ac: "/images/teeth/e2.png", name: '不可移动' }
                    ],
                    type: 0,
                    // colors: [[255, 255, 255], [150, 150, 150], [255, 247, 0], [239, 48, 93], [100, 184, 250]],
                },
                mounted: function () {
                    that = this;
                    this.selects = httpUrl('/api/Illcase/baseInfo.html', "post", {}, false, true).data;
                    this.selects.tssheji = this.selects.tssheji.map(item=>item.name)

                    useLayui(function (form, layer) {
                        that.fillData(form, layer);
                        that.jsfunc(layer);
                        that.init(form);
                        that.submit(form, layer, that);
                    })
                },
                methods: {
                    init(form) {


                        form.on('radio(radio)', function (data) {
                            let name = $(data.elem).attr("name");
                            let v = data.value;
                            console.log(name);
                            that.form[name] = v;
                            console.log(that.form);
                        })

                        form.on('radio(*)', function (data) {
                            let name = $(data.elem).attr("name");
                            let v = data.value;
                            that.form[name] = v;
                            if (name == 'center_correct') {
                                fillRadio(['对齐上中线', '对齐下中线', '对齐面中线'], "center_correct_2", that);
                            }
                            form.render("radio");
                        });

                        function fillRadio(list, name, checkedValue, that) {
                            let str = "";
                            for (j = 0, len = list.length; j < len; j++) {
                                if (list[j] == checkedValue) {
                                    str += `<input type="radio" lay-filter="*" class="${name}" name="${name}" value="${list[j]}" title="${list[j]}"  v-model="form.${name}" checked>`;
                                } else {
                                    str += `<input type="radio" lay-filter="*" class="${name}" name="${name}" value="${list[j]}" title="${list[j]}"  v-model="form.${name}">`;
                                }
                            }
                            if (!checkedValue) {
                                that.form[name] = "";
                            }
                            $("#" + name).html(str);
                        }


                        // form.on('radio(setplan)', function (data) {
                        //     that.form.set_plan = data.value;
                        // });
                        form.on('select(*)', function (data) {
                            let name = $(data.elem).attr("name");
                            let v = data.value;
                            that.form[name] = v;
                            console.log(that.form);
                        });

                        form.on('select(tuocao)', function (data) {
                            let bind = $("option[value='" + data.value + "']").attr('data-bind');
                            let bind2 = $("option[value='" + data.value + "']").attr('data-bind2');
                            for (let i = 0; i < that.selects.jiamian.length; i++) {
                                if (that.selects.jiamian[i].id == bind) {
                                    form.val("caseForm", { "fixed_face": that.selects.jiamian[i].name });
                                    break;
                                }
                            }
                            for (let i = 0; i < that.selects.jiamian2.length; i++) {
                                if (that.selects.jiamian2[i].id == bind2) {
                                    form.val("caseForm", { "fixed_face2": that.selects.jiamian2[i].name });
                                    break;
                                }
                            }
                        });

                        form.on('checkbox(tssheji)', function (data) {
                            let value = data.value;
                            if(data.elem.checked){
                                if(value=='自定义'){
                                    that.form.tssheji = ['自定义'];
                                }else{
                                    let index = that.form.tssheji.findIndex(item=>item=='自定义');
                                    if(index!=-1){
                                        that.form.tssheji.splice(index,1);
                                    }
                                    that.form.tssheji.push(value);
                                }
                            }else{
                                let index = that.form.tssheji.findIndex(item=>item==value);
                                that.form.tssheji.splice(index,1)
                            }
                            form.render('checkbox');
                            console.log(that.form.tssheji);
                        });
                    },
                    check_tssheji(value){
                        // 特殊设计
                        // console.log(this.form);return false;
                        let index = this.form.tssheji.findIndex(item=>item==value)
                        if(index!=-1){
                            this.form.tssheji.splice(index,1);
                        }else{
                            if(value=='自定义'){
                                this.form.tssheji = ['自定义'];
                            }else if(value=='无'){
                                this.form.tssheji = ['无'];
                            }else{
                                this.form.tssheji.push(value);
                                var n = this.form.tssheji.findIndex(item=>{
                                   return  item=='自定义' || item=='无'
                                })
                                if(n!=-1){
                                    this.form.tssheji.splice(n,1);
                                }

                            }
                        }
                    },
                    jsfunc(layer) {

                        $(".showWhy").hover(function () {
                            let id = $(this).attr("id");
                            let text = $(this).attr("text");
                            layer.tips(text, '#' + id, {
                                tips: [1, '#333'],
                                time: 400000
                            });
                        }, function () {
                            layer.closeAll()
                        })
                    },
                    setType(index) {
                        this.type = index + 1;
                    },
                    fillData(form, layer) {
                        let id = getUrlParam('id');
                        if (!id) {
                            this.canvasFunc();
                            this.specialStatus = 1;
                            return false;
                        }
                        this.form.case_no = id;
                        let data = httpUrl('/api/Illcase/info.html', "post", { case_no: id }).data;
                        this.is_close = data.is_close;

                        this.show_zhikang = data.tooth_seat ? data.tooth_seat.includes("2") : false



                        let formData = that.form;
                        for (let e in formData) {
                            formData[e] = data[e]
                        }
                        console.log("formData");
                        console.log(formData);

                        if (!formData.fixed_slot) {
                            formData.fixed_slot = this.selects.tuocao[0].name
                        }
                        if (!formData.fixed_face) {
                            formData.fixed_face = this.selects.jiamian[0].name
                        }
                        if (!formData.fixed_face2) {
                            formData.fixed_face2 = this.selects.jiamian2[0].name
                        }


                        if (data.jiuzhengguanxi) {
                            let arr = data.jiuzhengguanxi.split(" | ");
                            let l = arr[0].split("-");
                            formData.jiuzhengguanxi_left = l[1];
                            l[2] && (formData.jiuzhengguanxi_left_2 = l[2]);

                            if(arr[1]){
                                let r = arr[1].split("-");
                                formData.jiuzhengguanxi_right = r[1];
                                r[2] && (formData.jiuzhengguanxi_right_2 = r[2]);
                            }
                        }


                        if (data.center_correct) {
                            let arr = data.center_correct.split("-");
                            formData.center_correct = arr[0];
                            arr[1] && (formData.center_correct_2 = arr[1]);
                        }


                        if (data.tooth_seat && Boolean(data.tooth_seat)) {
                            that.tooth = data.tooth_seat;
                        }
                        that.canvasFunc();



                        if (!data.tsqingkuang_yaohe) {
                            formData.tsqingkuang_yaohe = '正常设计';
                        }
                        if (!data.tsqingkuang_tuocao) {
                            formData.tsqingkuang_tuocao = '不设计托槽位置';
                        }

                          // 特殊设计
                        let tssheji = data.tssheji;
                        if(tssheji){
                            console.log(that.selects.tssheji);
                            console.log(that.selects.tssheji.includes(tssheji));
                            let arr = tssheji.split(",");
                            if(arr.length==1 && !that.selects.tssheji.includes(tssheji)){
                                console.log(11);
                                that.form.tssheji_custom = tssheji;
                                that.form.tssheji = ['自定义'];
                            }else{
                                console.log(22);
                                that.form.tssheji = tssheji.split(",");
                            }
                        }else{
                            that.form.tssheji = [];
                        }

                        form.val('caseForm', formData)

                    },

                    submit(form, layer, that) {
                        form.on('submit(caseForm)', function (data) {
                            let params = data.field;
                            params.tooth_seat = that.tooth;

                            // 矢状向 s
                            let left = ['左'];
                            let right = ['右'];
                            let l = params.jiuzhengguanxi_left;
                            let r = params.jiuzhengguanxi_right;
                            if(l){
                                let l2 = params.jiuzhengguanxi_left_2;
                                left.push(l)
                                if(l == '调整' && l2){
                                    left.push(l2)
                                }
                            }else{
                                left.push('无')
                            }

                            if(r){
                                right.push(r)
                                let l2 = params.jiuzhengguanxi_right_2;
                                if(r == '调整' && l2){
                                    right.push(l2)
                                }
                            }else{
                                right.push('无')
                            }
                            params.jiuzhengguanxi = left.join("-")+" | "+right.join("-");
                            console.log(params);

                            delete params["jiuzhengguanxi_left"];
                            delete params["jiuzhengguanxi_left_2"];
                            delete params["jiuzhengguanxi_right"];
                            delete params["jiuzhengguanxi_right_2"];

                             // 矢状向 e

// return false;
                            if (params.center_correct == '改善' && !params.center_correct_2) {

                            }

                            let center_correct = [params.center_correct];
                            if (params.center_correct_2) { center_correct.push(params.center_correct_2) }
                            params.center_correct = center_correct.join("-");
                            delete params['center_correct_2']

                            let tssheji = that.form.tssheji;
                            if(tssheji=='自定义'){
                                tssheji = [that.form.tssheji_custom];
                            }
                            if(tssheji){
                                params.tssheji = tssheji.join(",");
                            }
                            delete params['tssheji_custom']

                            if(!that.show_zhikang){
                                params.zikang = "";
                            }

                            console.log(params);
                            var loadindex = layer.load();
                            let res = httpUrl('/api/Illcase/design.html', "post", params);
                            layer.close(loadindex);
                            layer.msg(res.msg);
                            if (res.code == 1) {
                                setTimeout(function () {
                                    location.href = './three.html?id=' + params.case_no
                                }, 1500)
                            }
                            return false;
                        })

                    },
                    canvasFunc() {
                        let that = this;
                        that.$nextTick(function () {
                            for (let i = 0; i < that.tooth.length; i++) {
                                let canvas = document.querySelectorAll(".cantooth")[i];
                                if (canvas.getContext) {
                                    let ctx = canvas.getContext("2d");
                                    let img = new Image();
                                    let dir = ['a', 'b', 'c', 'd', 'e'];
                                    img.src = "/images/teeth/" + dir[that.tooth[i]] + "/" + i + ".png";
                                    img.onload = function () {
                                        canvas.width = img.width
                                        canvas.height = img.height
                                        ctx.drawImage(img, 0, 0, img.width, img.height)
                                    }
                                    canvas.addEventListener('click', function (e) {
                                        let folder = ['a', 'b', 'c', 'd', 'e'][that.type];
                                        img.src = "/images/teeth/" + folder + "/" + i + ".png";
                                        that.tooth[i] = that.type+"";
                                        img.onload = function () {
                                            canvas.width = img.width
                                            canvas.height = img.height
                                            ctx.drawImage(img, 0, 0, img.width, img.height)
                                        }
                                        that.show_zhikang = that.tooth.includes("2");

                                    })

                                }
                            }
                        })
                    },
                },
            })
        </script>
    </div>
</body>

<style>
    /* <i class="err layui-icon layui-icon-close-fill"></i> */
    .layui-form-label.err {
        color: red;
    }

    .layui-form-label i {
        display: inline-block;
        font-size: 18px;
        vertical-align: middle;
        position: relative;
        top: -1px;
    }

    .form .layui-form-label {
        text-align: left;
    }
</style>

</html>